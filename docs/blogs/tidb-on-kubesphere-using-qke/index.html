


<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<title>TiDB on KubeSphere: Using Cloud-Native Distributed Database on Kubernetes Platform Tailored for Hybrid Cloud</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="This blog demonstrates how to add a PingCap repository to KubeSphere to deploy tidb-operator and tidb-cluster.">
<meta name="keywords" content="Kubernetes, KubeSphere, TiDB, QingCloud Kubernetes Engine">

<meta property="og:type" content="article"/>
<meta property="og:title" content="TiDB on KubeSphere: Using Cloud-Native Distributed Database on Kubernetes Platform Tailored for Hybrid Cloud"/>
<meta property="og:description" content="This blog demonstrates how to add a PingCap repository to KubeSphere to deploy tidb-operator and tidb-cluster."/>
<meta property="og:image" content="https://ap3.qingstor.com/kubesphere-website/docs/tidb-architecture.png"/>
<meta property="og:url" content="https://cnimages.github.io/website/blogs/tidb-on-kubesphere-using-qke/"/>

<meta name="docsearch:language" content="en-US" /><link rel="stylesheet" href="/fonts/Roboto/stylesheet.css">
<link rel="stylesheet" href="/fonts/ProximaNova/stylesheet.css">
<link rel="stylesheet" href="/css/jquery.modal.min.css">
<link rel="stylesheet" href="/css/viewer.min.css">


<link rel="stylesheet" href="/website/scss/common.min.fd2f2584615728a729ee87ecf658d2f2e62d4c55dc6ca4c90029116aa21ee2e8.css">











<script src='/website/js/jquery-3.5.0.min.js'></script>
<script src='/website/js/viewer.min.js'></script>
<script src='/website/js/jquery.modal.min.js'></script>










<script type='text/javascript'>
!function(e,t,n,g,i){e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=('https:'==document.location.protocol?'https://':'http://')+g,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio");
  gio('init', '8a24ae300cbf8b8c', {});
  
  
  gio('send');
</script>





    <link rel="stylesheet" href="/website/scss/content.min.cd01785de7a83de330d32ac3aef7e5f4e0aa8c5e62c21008e4779016e3fd9517.css">
    
    
    <link rel="stylesheet" href="/website/scss/markdown.min.0de31cde2c91847e0e6c6f43d52658e6347b056a9da347546c21a7786900bfcf.css">
</head>


<body>
   
  
<header class="navigation">
    
    <div class="common-layout">
        <div class="header-container">
            <a href="/website/">
                <img src="/images/header/logo.svg" alt="" class="logo">
            </a>

            <ul class="nav">
                
                
                

                
                
                    
                
                    
                
                    
                

                <li  class="menu-li" >
                    <span class='menu-span'>Scenarios</span>
                    <ul class="dropdown-menu menu-2">
                        
                        <li >
                            
                            <a href="/website/devops/">Embracing One-stop DevOps Workflow</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/website/service-mesh/">Running Microservices on Kubernetes</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/website/observability/">Building Cloud Native Observability</a>
                            
                        </li>
                        
                    </ul>
                </li>
                

                
                

                
                
                    
                
                    
                
                    
                
                    
                

                <li  class="menu-li" >
                    <span class='menu-span'>Resources</span>
                    <ul class="dropdown-menu menu-3">
                        
                        <li >
                            
                            <a href="/website/projects/">Open Source Projects</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/website/conferences/">KubeCon & QCon</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/website/blogs/">Technology Blogs</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/website/videos/">Video Resources</a>
                            
                        </li>
                        
                    </ul>
                </li>
                

                
                

                
                
                    
                
                    
                
                    
                
                    
                

                <li  class="menu-li" >
                    <span class='menu-span'>Documentation</span>
                    <ul class="dropdown-menu menu-4">
                        
                        <li >
                            
                            <a href="/website/docs/">v3.0.0 <img src='/images/header/star.svg' alt='star'></a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="https://v2-1.docs.kubesphere.io/docs" target="_blank" rel="noopener noreferrer">v2.1.x</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="https://v2-0.docs.kubesphere.io/docs/" target="_blank" rel="noopener noreferrer">v2.0.x</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="https://v1-0.docs.kubesphere.io/docs/" target="_blank" rel="noopener noreferrer">v1.0.0</a>
                            
                        </li>
                        
                    </ul>
                </li>
                

                
                

                
                
                    
                
                    
                
                    
                
                    
                
                    
                

                <li  class="menu-li" >
                    <span class='menu-span'>Community</span>
                    <ul class="dropdown-menu menu-5">
                        
                        <li >
                            
                            <a href="/website/contribution/">Contribution</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/website/case/">Case Studies</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/website/partner/">Partner</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/website/news/">News</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="https://github.com/cnimages/kubesphere/blob/master/docs/roadmap.md" target="_blank" rel="noopener noreferrer">RoadMap</a>
                            
                        </li>
                        
                    </ul>
                </li>
                

                

            </ul>
            <div class="right-menu">
                <ul>
                    <li class="language-menu">
                        <div>
                            <img src="/images/header/black.svg" alt="">
                            <span>English</span>
                        </div>
                        
                        <ul class="dropdown-menu">
                            
                            <li onclick="location = '\/website\/blogs\/tidb-on-kubesphere-using-qke\/'">English</li>
                            
                        </ul>
                        
                    </li>
                    <li class='btn-li'>
                        <a href="https://demo.kubesphere.io/login" target="_blank" rel="noopener noreferrer">
                            <button class="demo-btn">Demo →</button>
                        </a>
                        <ol class="dropdown-menu">
                            <li>1.Experience account: demo1 / Demo123</li>
                            <li>2.This account is only allowed to view parts of UI</li>
                            <li>3.It&#39;s recommended that install KubeSphere in your environment</li>
                        </ol>
                    </li>
                    <li class='link-li'>
                        <a class='link-1' href="https://join.slack.com/t/kubesphere/shared_invite/enQtNTE3MDIxNzUxNzQ0LTZkNTdkYWNiYTVkMTM5ZThhODY1MjAyZmVlYWEwZmQ3ODQ1NmM1MGVkNWEzZTRhNzk0MzM5MmY4NDc3ZWVhMjE" target="_blank" rel="noopener noreferrer"></a>
                        <a class='link-2' href="https://twitter.com/KubeSphere" target="_blank" rel="noopener noreferrer"></a>
                        <a class='link-3' href="https://github.com/cnimages/kubesphere" target="_blank" rel="noopener noreferrer"></a>
                    </li>
                    <li class="menu-icon">
                        <img src="/images/header/menu.svg" alt="">
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="modal-for-menu" class="modal">
        <ul class="nav">
            
            
            

            
            
                
            
                
            
                
            

            <li data-check="0"  class="menu-li" >
                <span class='menu-span'>Scenarios</span>
                <ul class="dropdown-menu">
                    
                    <li >
                        <a href="/website/devops/">Embracing One-stop DevOps Workflow</a>
                    </li>
                    
                    <li >
                        <a href="/website/service-mesh/">Running Microservices on Kubernetes</a>
                    </li>
                    
                    <li >
                        <a href="/website/observability/">Building Cloud Native Observability</a>
                    </li>
                    
                </ul>
            </li>
            

            
            

            
            
                
            
                
            
                
            
                
            

            <li data-check="0"  class="menu-li" >
                <span class='menu-span'>Resources</span>
                <ul class="dropdown-menu">
                    
                    <li >
                        <a href="/website/projects/">Open Source Projects</a>
                    </li>
                    
                    <li >
                        <a href="/website/conferences/">KubeCon & QCon</a>
                    </li>
                    
                    <li >
                        <a href="/website/blogs/">Technology Blogs</a>
                    </li>
                    
                    <li >
                        <a href="/website/videos/">Video Resources</a>
                    </li>
                    
                </ul>
            </li>
            

            
            

            
            
                
            
                
            
                
            
                
            

            <li data-check="0"  class="menu-li" >
                <span class='menu-span'>Documentation</span>
                <ul class="dropdown-menu">
                    
                    <li >
                        <a href="/website/docs/">v3.0.0 <img src='/images/header/star.svg' alt='star'></a>
                    </li>
                    
                    <li >
                        <a href="https://v2-1.docs.kubesphere.io/docs">v2.1.x</a>
                    </li>
                    
                    <li >
                        <a href="https://v2-0.docs.kubesphere.io/docs/">v2.0.x</a>
                    </li>
                    
                    <li >
                        <a href="https://v1-0.docs.kubesphere.io/docs/">v1.0.0</a>
                    </li>
                    
                </ul>
            </li>
            

            
            

            
            
                
            
                
            
                
            
                
            
                
            

            <li data-check="0"  class="menu-li" >
                <span class='menu-span'>Community</span>
                <ul class="dropdown-menu">
                    
                    <li >
                        <a href="/website/contribution/">Contribution</a>
                    </li>
                    
                    <li >
                        <a href="/website/case/">Case Studies</a>
                    </li>
                    
                    <li >
                        <a href="/website/partner/">Partner</a>
                    </li>
                    
                    <li >
                        <a href="/website/news/">News</a>
                    </li>
                    
                    <li >
                        <a href="https://github.com/cnimages/kubesphere/blob/master/docs/roadmap.md">RoadMap</a>
                    </li>
                    
                </ul>
            </li>
            

            

        </ul>
        <div class="btn-div">
            <a href="https://demo.kubesphere.io/login" target="_blank" rel="noopener noreferrer">
                <button class="demo-btn">Demo →</button>
            </a>
        </div>
        <div class="link-div">
            <a href="https://join.slack.com/t/kubesphere/shared_invite/enQtNTE3MDIxNzUxNzQ0LTZkNTdkYWNiYTVkMTM5ZThhODY1MjAyZmVlYWEwZmQ3ODQ1NmM1MGVkNWEzZTRhNzk0MzM5MmY4NDc3ZWVhMjE" target="_blank" rel="noopener noreferrer">
                <img src="/images/header/slack-hover.svg" alt="">
            </a>
            <a href="https://twitter.com/KubeSphere" target="_blank" rel="noopener noreferrer">
                <img src="/images/header/twitter-hover.svg" alt="">
            </a>
            <a href="https://github.com/cnimages/kubesphere" target="_blank" rel="noopener noreferrer">
                <img src="/images/header/github-hover.svg" alt="">
            </a>
        </div>
    </div>
</header>
<script>
var bindNavMouseEvent = function(selector) {
    var flag = false
    $(selector).mouseenter(function() {
        if (flag) {
            return false
        }
        flag = true
        $(this).find('.dropdown-menu').fadeIn(200, function() {
            flag = false
        })
    });
    $(selector).mouseleave(function() {
        $(this).find('.dropdown-menu').fadeOut(200)
    });
}

var bindScrollChangeHeader = function() {
    var check = 100
    var header = $('header')
    window.addEventListener('scroll', function() {
        var scrollY = window.scrollY;
        if (scrollY > 100) {
            header.addClass('navigationScroll')
        } else {
            header.removeClass('navigationScroll')
        }
    })
}

var bindClickShowMenu = function() {
    $('.menu-icon').click(function() {
        $('#modal-for-menu').modal()
    })
}

var bindClickModalLi = function() {
    $('.modal .menu-li').click(function() {
        var check = $(this).data('check')
        if (check === 0) {
            $(this).data('check', 1)
            $(this).find('.dropdown-menu').slideDown(200)
        } else {
            $(this).data('check', 0)
            $(this).find('.dropdown-menu').slideUp(200)
        }
        $(this).find('.menu-span').toggleClass('up')
    })
}

var bindClickClose = function() {
    $('#close-join').click(function() {
        $('.navigation .join-div').hide()
        $('.main-section').removeClass('padding')
    })
}

var language = 'en'

bindClickClose()

bindScrollChangeHeader()

bindNavMouseEvent('.header-container .menu-li')
bindNavMouseEvent('.header-container .language-menu')
bindNavMouseEvent('.header-container .btn-li')

bindClickShowMenu()
bindClickModalLi()


</script>

  <section class="main-section ">
      <div class="common-layout">
          <div class='breadcrumb'>
              
              <span><a href='/website/blogs'>Technology Blogs</a> > </span>
              <span>TiDB on KubeSphere: Using Cloud-Native Distributed Database on Kubernetes Platform Tailored for Hybrid Cloud</span>
          </div>
          <div class='main-div middle-div'>
              <div class='author'>Will, Feynman, Sherlock</div>
              <div class='date'>Published on：2020-10-28</div>
              <h1>TiDB on KubeSphere: Using Cloud-Native Distributed Database on Kubernetes Platform Tailored for Hybrid Cloud</h1>
              <div class="share-1">
                  <div class="share">
  <a href="http://twitter.com/share?url=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f&text=TiDB%20on%20KubeSphere%3a%20Using%20Cloud-Native%20Distributed%20Database%20on%20Kubernetes%20Platform%20Tailored%20for%20Hybrid%20Cloud" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Twitter.svg" alt="twitter icon">
  </a>
  <a href="http://reddit.com/submit?url=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f&title=TiDB%20on%20KubeSphere%3a%20Using%20Cloud-Native%20Distributed%20Database%20on%20Kubernetes%20Platform%20Tailored%20for%20Hybrid%20Cloud" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Reddit.svg" alt="reddit icon">
  </a>
  <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Facebook.svg" alt="facebook icon">
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Linkedin.svg" alt="linkedin icon">
  </a>
  <a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f&t=TiDB%20on%20KubeSphere%3a%20Using%20Cloud-Native%20Distributed%20Database%20on%20Kubernetes%20Platform%20Tailored%20for%20Hybrid%20Cloud" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/HackerNews.svg" alt="hackernews icon">
  </a>
</div>
              </div>
              <div class='content'>
                  <div class='md-body'>
                      <p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201028212049.png" alt="TiDB on KubeSphere"></p>
<p>In a world where Kubernetes has become the de facto standard to build application services that span multiple containers, running a cloud-native distributed database represents an important part of the experience of using Kubernetes. In this connection, <a href="https://docs.pingcap.com/tidb/dev/overview" target="_blank" rel="noopener noreferrer">TiDB</a>, a cloud-native, open-source NewSQL database that supports Hybrid Transactional and Analytical Processing (HTAP) workloads, meets those needs admirably. Its architecture is suitable for Kubernetes, and it is MySQL compatible. TiDB also features horizontal scalability, strong consistency, and high availability.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/tidb-architecture.png" alt="tidb-architecture"></p>
<p>In addition to TiDB, I am also using <a href="https://kubesphere.io/" target="_blank" rel="noopener noreferrer">KubeSphere</a>, an open-source distributed operating system that manages cloud-native applications with <a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes</a> as its kernel. It provides a plug-and-play architecture for the seamless integration of third-party applications to boost its ecosystem. <a href="https://kubesphere.io/docs/introduction/what-is-kubesphere/#run-kubesphere-everywhere" target="_blank" rel="noopener noreferrer">KubeSphere can be run anywhere</a> as it is highly pluggable without any hacking into Kubernetes.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/KubeSphere-structure-comp.png" alt="KubeSphere-structure-comp"></p>
<p>By combining TiDB with KubeSphere, we can have Kubernetes-powered TiDB clusters, and manage the clusters using a developer-friendly wizard web UI. In this post, I will demonstrate how to deploy TiDB on KubeSphere from scratch.</p>
<h2 id="preparing-environments">Preparing Environments</h2>
<p>As you can imagine, the very first thing to consider is to have a Kubernetes cluster so that you can deploy TiDB. Well, in this regard, the installation of Kubernetes may have haunted a large number of neophytes, especially the preparation of working machines, either physical or virtual. Besides, you also need to configure different network rules so that traffic can move smoothly among instances. Fortunately, QingCloud, the sponsor of KubeSphere, provides users with a highly functional platform that enables them to quickly deploy Kubernetes and KubeSphere at the same time (you can choose to deploy Kubernetes only). Namely, you only need to click few buttons and the platform will do the rest.</p>
<p>Therefore, I select QingCloud Kubernetes Engine (QKE) to prepare the environment. In fact, you can also use instances on the platform directly and <a href="https://kubesphere.io/docs/installing-on-linux/public-cloud/kubesphere-on-qingcloud-instance/" target="_blank" rel="noopener noreferrer">deploy a highly-available Kubernetes cluster with KubeSphere installed</a>. Here is how I deploy the cluster and TiDB:</p>
<ol>
<li>
<p>Log in the <a href="https://console.qingcloud.com/" target="_blank" rel="noopener noreferrer">web console of QingCloud</a>. Simply select <strong>KubeSphere (QKE)</strong> from the menu and create a Kubernetes cluster with KubeSphere installed. The platform allows you to install different components of KubeSphere. Here, we need to enable <a href="https://github.com/openpitrix/openpitrix" target="_blank" rel="noopener noreferrer">OpenPitrix</a>, which powers the app management feature in KubeSphere.</p>
<div class="notices note">
  
  <p>Note</p>
  <div>KubeSphere can be installed on any infrastructure. I just use QingCloud Platform as an example. See <a href="https://kubesphere.io/docs/">KubeSphere Documentation</a> for more details.</div>
</div>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026173924.png" alt="qingcloud-kubernetes-engine"></p>
</li>
<li>
<p>The cluster will be up and running in around 10 minutes. In this example, I select 3 working nodes to make sure I have enough resources for the deployment later. You can also customize configurations based on your needs. When the cluster is ready, log in the web console of KubeSphere with the default account and password (<code>admin/P@88w0rd</code>). Here is the cluster <strong>Overview</strong> page:</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026175447.png" alt="cluster-management"></p>
</li>
<li>
<p>Use the built-in <strong>Web Kubectl</strong> from the Toolkit in the bottom right corner to execute the following command to install TiDB Operator CRD:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/v1.1.6/manifests/crd.yaml
</code></pre></div></li>
<li>
<p>You can see the expected output as below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">customresourcedefinition.apiextensions.k8s.io/tidbclusters.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/backups.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/restores.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/backupschedules.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/tidbmonitors.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/tidbinitializers.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/tidbclusterautoscalers.pingcap.com created
</code></pre></div></li>
<li>
<p>Now, let&rsquo;s get back to the <strong>Access Control</strong> page where all the workspaces are listed. Before I proceed, first I need to create a new workspace (e.g. <code>dev-workspace</code>).</p>
<p>In a workspace, different users have different permissions to perform varied tasks in projects. Usually, a department-wide project requires a multi-tenant system so that everyone is responsible for their own part. For demonstration purposes, I use the account <code>admin</code> in this example. You can <a href="https://kubesphere.io/docs/quick-start/create-workspace-and-project/" target="_blank" rel="noopener noreferrer">see the official documentation of KubeSphere</a> to know more about how the multi-tenant system works.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026192648.png" alt="create-workspace"></p>
</li>
<li>
<p>Go to a workspace, and you can see that KubeSphere provides two methods to add Helm charts. This article only talks about the first one, which is adding an app repository in KubeSphere. Alternatively, you can also upload your own app templates and submit them to the KubeSphere App Store, which will be talked about in my next blog. Here, follow the images below to add the Helm repository of PingCap (<a href="https://charts.pingcap.org">https://charts.pingcap.org</a>) in <strong>App Repos</strong>.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026192824.png" alt="app-repo"></p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026193015.png" alt="add-pingcap-repo"></p>
</li>
</ol>
<h2 id="deploying-tidb-operator">Deploying TiDB Operator</h2>
<p><a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener noreferrer">TiDB Operator</a> is an automatic operation system for TiDB clusters in Kubernetes. It provides a full management life-cycle for TiDB, including deployment, upgrades, scaling, backup, fail-over, and configuration changes. With TiDB Operator, TiDB can run seamlessly in Kubernetes clusters deployed on public or private clouds. You need to first deploy TiDB Operator on KubeSphere.</p>
<ol>
<li>
<p>Like I mentioned above, we need to create a project (i.e. namespace) first to run TiDB Operator.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026193410.png" alt="create-project"></p>
</li>
<li>
<p>After the project is created, navigate to <strong>Applications</strong> and click <strong>Deploy New Application</strong>.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026193632.png" alt="deploy-new-app"></p>
</li>
<li>
<p>Select <strong>From App Templates</strong>.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026193657.png" alt="app-template"></p>
</li>
<li>
<p>Switch to the PingCAP repository that stores multiple Helm charts. This article only demonstrates how to deploy TiDB Operator and TiDB clusters. You can also deploy other tools based on your needs.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026193744.png" alt="select-pingcap-repo"></p>
</li>
<li>
<p>Click tidb-operator and select <strong>Chart Files</strong>. You can view the configuration from the console directly or download the default <code>values.yaml</code> file. From the drop-down menu on the right, you can also select the version you want to install.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027113228.png" alt="deploying-tidb"></p>
</li>
<li>
<p>Confirm your app name, version and deployment location.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027113416.png" alt="deployment-info"></p>
</li>
<li>
<p>You can edit the <code>values.yaml</code> file in this step, or click <strong>Deploy</strong> directly with the default configurations.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027113509.png" alt="check-config-file"></p>
</li>
<li>
<p>In <strong>Applications</strong>, wait for TiDB Operator to be up and running.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027131859.png" alt="tidb-running"></p>
</li>
<li>
<p>In <strong>Workloads</strong>, you can see two <strong>Deployments</strong> created for TiDB Operator.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027132001.png" alt="tidb-deployment"></p>
</li>
</ol>
<h2 id="deploying-a-tidb-cluster">Deploying a TiDB Cluster</h2>
<p>The process of deploying a TiDB cluster is similar to deploying TiDB Operator.</p>
<ol>
<li>
<p>Also from the PingCAP repository, select tidb-cluster.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026200620.png" alt="select-tidb-cluster"></p>
</li>
<li>
<p>Switch to <strong>Chart Files</strong> and download the <strong>values.yaml</strong> file.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027132136.png" alt="view-and-download-tidb-operator"></p>
</li>
<li>
<p>Some TiDB components require persistent volumes. In this regard, QingCloud Platform provides users with the following storage classes.</p>
<pre><code>/ # kubectl get sc
NAME                       PROVISIONER     RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
csi-high-capacity-legacy   csi-qingcloud   Delete          Immediate           true                   71m
csi-high-perf              csi-qingcloud   Delete          Immediate           true                   71m
csi-ssd-enterprise         csi-qingcloud   Delete          Immediate           true                   71m
csi-standard (default)     csi-qingcloud   Delete          Immediate           true                   71m
csi-super-high-perf        csi-qingcloud   Delete          Immediate           true                   71m
</code></pre></li>
<li>
<p>As I installed KubeSphere through QingCloud Kubernetes Engine (QKE), all of these storage components were deployed automatically by default. The QingCloud CSI plugin implements an interface between <a href="https://github.com/container-storage-interface/" target="_blank" rel="noopener noreferrer">CSI</a>-enabled Container Orchestrator (CO) and the storage of QingCloud. If you are interested in QingCloud CSI, have a look at their <a href="https://github.com/yunify/qingcloud-csi" target="_blank" rel="noopener noreferrer">GitHub repository</a>. Select csi-standard here by replacing the default value <code>local-storage</code> of the field <code>storageClassName</code> with <code>csi-standard</code> in <code>values.yaml</code>. In the downloaded file, you can replace all of them directly and copy and paste it to the <code>values.yaml</code> file.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201026204825.png" alt="tidb-cluster-config"><div class="notices note">
  
  <p>Note</p>
  <div>Only the field <code>storageClassName</code> is changed to provide external persistent storage. If you want to deploy each TiDB component, such as <a href="https://docs.pingcap.com/tidb/dev/tidb-architecture#tikv-server">TiKV</a> and <a href="https://docs.pingcap.com/tidb/dev/tidb-architecture#placement-driver-pd-server">Placement Driver</a>, to individual nodes, specify the field <code>nodeAffinity</code>.</div>
</div></p>
</li>
<li>
<p>Click <strong>Deploy</strong> and you can see two apps in the list as shown below:</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027132819.png" alt="tidb-cluster-app-ready"></p>
</li>
</ol>
<h2 id="viewing-tidb-cluster-status">Viewing TiDB Cluster Status</h2>
<p>Now that we have our apps ready, we may need to focus more on observability. KubeSphere gives users a straightforward view of how apps are doing during their whole lifecycle with different metrics available on the dashboard.</p>
<ol>
<li>
<p>Verify that all TiDB cluster Deployments are up and running in <strong>Workloads</strong>.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027132450.png" alt="tidb-cluster-deployment-ready"></p>
</li>
<li>
<p>TiDB, TiKV and PD are all stateful applications, which can be found in <strong>StatefulSets</strong>. Note that TiKV and TiDB will be created automatically and it may take a while before they display in the list.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027134239.png" alt="tidb-statefulsets"></p>
</li>
<li>
<p>Click a single StatefulSet to display its detail page. This page shows metrics in line charts over a period of time. The following is an example of TiDB metrics:</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027141426.png" alt="view-tidb-loads"></p>
</li>
<li>
<p>View TiKV loads:</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027141541.png" alt="view-tikv-loads"></p>
</li>
<li>
<p>Relevant Pods are also listed. As you can see, your TiDB cluster contains three PD Pods, two TiDB Pods and three TiKV Pods.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027134634.png" alt="tidb-pod-list"></p>
</li>
<li>
<p>Go to the <strong>Storage</strong> section, and you can see TiKV and PD are using persistent storage.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027133725.png" alt="tidb-storage-usage"></p>
</li>
<li>
<p>Volume usage is also monitored. Here is an example of TiKV:</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027141718.png" alt="tikv-volume-status"></p>
</li>
<li>
<p>On the <strong>Overview</strong> page, you can see a list of resource usage in the current project.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027141916.png" alt="tidb-project-resource-usage"></p>
</li>
</ol>
<h2 id="accessing-tidb-cluster">Accessing TiDB Cluster</h2>
<p>These services just created can be accessed easily as KubeSphere tells you how a service is being exposed on which port.</p>
<ol>
<li>
<p>In <strong>Services</strong>, you can see detailed information of all services.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027135010.png" alt="tidb-in-service-list"></p>
</li>
<li>
<p>As the service type is set to <code>NodePort</code>, you can access it through the Node IP address outside the cluster.</p>
</li>
<li>
<p>Here is a test of the connection to the database through MySQL client.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@k8s-master1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -it --rm mysql bash</span>
   
<span style="color:#f92672">[</span>root@0d7cf9d2173e:/# mysql -h 192.168.1.102 -P <span style="color:#ae81ff">32682</span> -u root
Welcome to the MySQL monitor.  Commands end with ; or <span style="color:#ae81ff">\g</span>.
Your MySQL connection id is <span style="color:#ae81ff">201</span>
Server version: 5.7.25-TiDB-v4.0.6 TiDB Server <span style="color:#f92672">(</span>Apache License 2.0<span style="color:#f92672">)</span> Community Edition, MySQL 5.7 compatible
   
Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 2000, 2020, Oracle and/or its affiliates. All rights reserved.
   
Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners.
   
Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.
   
mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| INFORMATION_SCHEMA |
| METRICS_SCHEMA     |
| PERFORMANCE_SCHEMA |
| mysql              |
| test               |
+--------------------+
<span style="color:#ae81ff">5</span> rows in set <span style="color:#f92672">(</span>0.01 sec<span style="color:#f92672">)</span>
   
mysql&gt; 
</code></pre></div></li>
<li>
<p>Besides, TiDB integrates Prometheus and Grafana to monitor performance of the database cluster. As we can see above, Grafana is being exposed through <code>NodePort</code>. After you configure necessary port forwarding rules and open its port in security groups on QingCloud Platform, you can access the Grafana UI to view metrics.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/20201027141035.png" alt="grafana-in-KubeSphere"></p>
</li>
</ol>
<h2 id="summary">Summary</h2>
<p>I hope you guys all have successfully deployed TiDB. Both TiDB and KubeSphere are powerful tools for cloud-native applications, so in fact, I cannot showcase every aspect of them all in this post. For example, the app deployment function has much to offer for cloud-native enthusiasts like me. I will post another article on how to deploy TiDB by uploading Helm charts to the KubeSphere App Store.</p>
<p>If you have any questions, don&rsquo;t hesitate to contact us in <a href="https://join.slack.com/t/kubesphere/shared_invite/enQtNTE3MDIxNzUxNzQ0LTZkNTdkYWNiYTVkMTM5ZThhODY1MjAyZmVlYWEwZmQ3ODQ1NmM1MGVkNWEzZTRhNzk0MzM5MmY4NDc3ZWVhMjE" target="_blank" rel="noopener noreferrer">Slack</a> or <a href="https://github.com/kubesphere" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>
<h2 id="references">References</h2>
<p><strong>KubeSphere GitHub</strong>: <a href="https://github.com/kubesphere/kubesphere">https://github.com/kubesphere/kubesphere</a></p>
<p><strong>TiDB GitHub</strong>: <a href="https://github.com/pingcap/TiDB">https://github.com/pingcap/TiDB</a></p>
<p><strong>TiDB Operator Documentation</strong>: <a href="https://docs.pingcap.com/tidb-in-kubernetes/stable/tidb-operator-overview">https://docs.pingcap.com/tidb-in-kubernetes/stable/tidb-operator-overview</a></p>
<p><strong>KubeSphere Introduction</strong>: <a href="https://kubesphere.io/docs/introduction/what-is-kubesphere/">https://kubesphere.io/docs/introduction/what-is-kubesphere/</a></p>
<p><strong>KubeSphere Documentation</strong>: <a href="https://kubesphere.io/docs/">https://kubesphere.io/docs/</a></p>

                  </div>
              </div>
              <div class="share-2">
                  <div class="share">
  <a href="http://twitter.com/share?url=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f&text=TiDB%20on%20KubeSphere%3a%20Using%20Cloud-Native%20Distributed%20Database%20on%20Kubernetes%20Platform%20Tailored%20for%20Hybrid%20Cloud" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Twitter.svg" alt="twitter icon">
  </a>
  <a href="http://reddit.com/submit?url=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f&title=TiDB%20on%20KubeSphere%3a%20Using%20Cloud-Native%20Distributed%20Database%20on%20Kubernetes%20Platform%20Tailored%20for%20Hybrid%20Cloud" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Reddit.svg" alt="reddit icon">
  </a>
  <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Facebook.svg" alt="facebook icon">
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Linkedin.svg" alt="linkedin icon">
  </a>
  <a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fcnimages.github.io%2fwebsite%2fblogs%2ftidb-on-kubesphere-using-qke%2f&t=TiDB%20on%20KubeSphere%3a%20Using%20Cloud-Native%20Distributed%20Database%20on%20Kubernetes%20Platform%20Tailored%20for%20Hybrid%20Cloud" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/HackerNews.svg" alt="hackernews icon">
  </a>
</div>
              </div>
          </div>
          <div class='aside'>
              <div class="inner-div">
                <div class='title'>Table of Contents</div>
                <div class='tabs'><nav id="TableOfContents">
  <ul>
    <li><a href="#preparing-environments">Preparing Environments</a></li>
    <li><a href="#deploying-tidb-operator">Deploying TiDB Operator</a></li>
    <li><a href="#deploying-a-tidb-cluster">Deploying a TiDB Cluster</a></li>
    <li><a href="#viewing-tidb-cluster-status">Viewing TiDB Cluster Status</a></li>
    <li><a href="#accessing-tidb-cluster">Accessing TiDB Cluster</a></li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
              </div>
          </div>
      </div>
  </section>
  <footer>
    
    <div class="footer">
        <div class="footer-main common-layout">
            <div class="up-main">
                <div class="left-div">
                    <img src="/website/images/logo.svg" alt="" class="foot-logo">
                    <p>Receive the latest news, articles and updates from KubeSphere</p>
                    <div>
                        <form
                            action="https://kubesphere.us10.list-manage.com/subscribe/post?u=c85ea2b944b08b951f607bdd4&amp;id=83f673a2d9"
                            method="post"
                            target="_blank"
                            novalidate
                        >
                            <input name="EMAIL" id="email-input" type="text" placeholder='Please enter your email address'>
                            <button type="submit" id="email-submit">Subscribe</button>
                        </form>
                    </div>
                    <span id="message" data-message1='email is required!' data-message2='Please enter a valid email address!'></span>
                </div>
                <div class="right-div">
                    <ul class="common-flex-layout">
                        
                        
                            <li>
                                <div class="h3">Scenarios</div>
                                
                                
                                <a href="/website/devops/">Embrace DevOps</a>
                                
                                
                                
                                <a href="/website/service-mesh/">Microservices on K8s</a>
                                
                                
                                
                                <a href="/website/observability/">Cloud Native Observability</a>
                                
                                
                                
                                <a href="https://porterlb.io/" target="_blank" rel="noopener noreferrer">Bare Metal LoadBalancer</a>
                                
                                
                                
                                <a href="https://github.com/openpitrix/openpitrix" target="_blank" rel="noopener noreferrer">Multi-cloud Apps Mgmt</a>
                                
                                
                                
                                <a href="https://github.com/kubesphere/fluentbit-operator" target="_blank" rel="noopener noreferrer">Logging management</a>
                                
                                
                            </li>
                        
                            <li>
                                <div class="h3">Resources</div>
                                
                                
                                <a href="/website/projects/">Projects</a>
                                
                                
                                
                                <a href="/website/blogs/">Blogs</a>
                                
                                
                                
                                <a href="/website/conferences/">KubeCon &amp; QCon</a>
                                
                                
                                
                                <a href="/website/videos/">Videos</a>
                                
                                
                            </li>
                        
                            <li>
                                <div class="h3">KubeSphere Docs</div>
                                
                                
                                <a href="/docs/introduction/what-is-kubesphere/">Introduction</a>
                                
                                
                                
                                <a href="/docs/quick-start/all-in-one-on-linux/">Installation</a>
                                
                                
                                
                                <a href="/docs/quick-start/create-workspace-and-project/">Tutorial</a>
                                
                                
                                
                                <a href="/docs/api-reference/api-docs/">API Documentation</a>
                                
                                
                            </li>
                        
                            <li>
                                <div class="h3">Community</div>
                                
                                
                                <a href="/website/contribution/">Contribution</a>
                                
                                
                                
                                <a href="/website/case/">Case Studies</a>
                                
                                
                                
                                <a href="/website/partner/">Partners</a>
                                
                                
                                
                                <a href="https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md" target="_blank" rel="noopener noreferrer">Roadmap</a>
                                
                                
                                
                                <a href="https://kubesphere.io" target="_blank" rel="noopener noreferrer">Global Site</a>
                                
                                
                                
                                <a href="https://kubesphere.com.cn/" target="_blank" rel="noopener noreferrer">China Site</a>
                                
                                
                                
                                <a href="https://kubesphere.eu" target="_blank" rel="noopener noreferrer">Europe Site</a>
                                
                                
                                
                                <a href="https://kubesphereturkey.com" target="_blank" rel="noopener noreferrer">Turkey Site</a>
                                
                                
                                
                                <a href="https://kubesphere.es" target="_blank" rel="noopener noreferrer">Spain Site</a>
                                
                                
                            </li>
                        
                        
                    </ul>
                </div>
            </div>
            <div class="down-main">
                <div class='img-div'>
                    <a class='wechat' href="javascript:void(0);">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28">
    <defs>
        <path id="a" d="M0 0h15.673v12.156H0z"/>
    </defs>
    <g fill="none" fill-rule="evenodd" transform="translate(1 1)">
        <circle cx="13" cy="13" r="13" stroke="#B6C2CD"/>
        <g transform="translate(5 7)">
            <mask id="b" fill="#fff">
                <use xlink:href="#a"/>
            </mask>
            <path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59 0-4.625 1.679-4.625 3.74 0 2.066 2.035 3.738 4.625 3.738.542 0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27 0-.541-.257-.541-.514 0-.256.27-.514.541-.514.41 0 .681.258.681.514 0 .257-.271.514-.681.514zm2.994 0c-.27 0-.541-.257-.541-.514 0-.256.27-.514.54-.514.41 0 .681.258.681.514 0 .257-.277.514-.68.514z" mask="url(#b)"/>
            <path fill="currentColor" d="M10.602 3.674c.177 0 .356.011.533.029C10.657 1.576 8.27 0 5.543 0 2.498 0 0 1.974 0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17 0 .343-.005.515-.022a3.68 3.68 0 0 1-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417 0 .693.263.693.66s-.276.66-.693.66c-.418 0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417 0-.834-.263-.834-.66s.417-.66.834-.66c.418 0 .695.263.695.66 0 .392-.277.66-.695.66z" mask="url(#b)"/>
        </g>
    </g>
</svg>

                        <div class="hide-div">
                            <p>Follow the official account</p>
                            <img src="/images/footer/wechat_code.svg" alt="">
                        </div>
                    </a>
                    <a class='facebook-a' href="https://www.facebook.com/kubesphere" target="_blank"></a>
                    <a class='twitter-a' href="https://twitter.com/KubeSphere" target="_blank" rel="noopener noreferrer"></a>
                    <a class='linkedin-a' href="https://www.linkedin.com/company/kubesphere/" target="_blank" rel="noopener noreferrer"></a>
                    
                    <a class='youtube-a' href="https://www.youtube.com/channel/UCyTdUQUYjf7XLjxECx63Hpw" target="_blank" rel="noopener noreferrer"></a>
                    <a class='slack-a' href="https://join.slack.com/t/kubesphere/shared_invite/enQtNTE3MDIxNzUxNzQ0LTZkNTdkYWNiYTVkMTM5ZThhODY1MjAyZmVlYWEwZmQ3ODQ1NmM1MGVkNWEzZTRhNzk0MzM5MmY4NDc3ZWVhMjE" target="_blank" rel="noopener noreferrer"></a>
                    <a class='github-a' href="https://github.com/cnimages/kubesphere" target="_blank" rel="noopener noreferrer"></a>
                    <a class='medium-a' href="https://itnext.io/@kubesphere" target="_blank" rel="noopener noreferrer"></a>
                </div>
                <p class='p1'>KubeSphere®️ 2020 All Rights Reserved.</p>
                
            </div>
        </div>
    </div>

</footer>

<script>
    var bindSubmit = function() {
        var input = $('#email-input')
        $('#email-submit').click(function(event) {
            event.stopPropagation()
            var email = input.val()
            var message1 = $('#message').data('message1')
            var message2 = $('#message').data('message2')
            if (!email) {
                event.preventDefault()
                showMessage(message1)
            } else if (!validateEmail(email)) {
                event.preventDefault()
                showMessage(message2)
            }
        })
    }

    var bindHideMessage = function() {
        $(window).click(function() {
            $('#message').hide()
        })
    }

    var showMessage = function(message) {
        $('#message').html(message).show()
    }

    var validateEmail = function(email) {
        var reg = /^[A-Za-z0-9]+([_\.][A-Za-z0-9]+)*@([A-Za-z0-9\-]+\.)+[A-Za-z]{2,6}$/
        return reg.test(email)
    }

    var lazyLoad = function(allImg, imgNum) {
        for (var i = 0; i < imgNum; i++) {
            var img = allImg.eq(i)
            var loaded = img.attr("data-loaded");
            if (loaded) {
                continue
            }
            if (img.offset().top < parseInt($(window).height()) + parseInt($(window).scrollTop())) {
                var src = img.attr("src")
                img.attr("src", src)
                img.attr("data-loaded", true)
            }
        }
    }

    var bindLayLoad = function() {
        var allImg = $('img')
        var imgNum = allImg.length
        lazyLoad(allImg, imgNum)
        $(window).scroll(function() {
            lazyLoad(allImg, imgNum)
        });
    }

    
    bindSubmit()
    bindHideMessage()
</script>

  
  
  <script type="text/javascript" src="/website/js/aside.34d4ca232760855916fede489417772adb45cdceab8541c6f6826e5d83a0b68e071a44f76a077fe90e39afe213cc1aab40272900f7cbdffb45068c7746c7b183.js" integrity="sha512-NNTKIydghVkW/t5IlBd3KttFzc6rhUHG9oJuXYOgto4HGkT3agd/6Q45r&#43;ITzBqrQCcpAPfL3/tFBox3Rsexgw=="></script>
  
  
  
  <script type="text/javascript" src="/website/js/markdown-tab.224c8a343197870e80877ad07e19b932b807d3fde3abccde667f2156378cb00497ebb11d2f872f09ea91e7282e87655f8cb4ef163da46e34d00dca44dbf52aad.js" integrity="sha512-IkyKNDGXhw6Ah3rQfhm5MrgH0/3jq8zeZn8hVjeMsASX67EdL4cvCeqR5yguh2VfjLTvFj2kbjTQDcpE2/UqrQ=="></script>
  
  <script>
    var viewer = new Viewer(document.querySelector('.md-body'), {
        url: 'src'
    })
  </script>
</body>

</html>
