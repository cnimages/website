


<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<title>Kubernetes Multi-cluster Deployment: Federation and KubeSphere</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="KubeSphere v3.0 supports the management of multiple clusters, isolated management of resources, and federated deployments.">
<meta name="keywords" content="Kubernetes, KubeSphere, Multi-cluster, Container">

<meta property="og:type" content="article"/>
<meta property="og:title" content="Kubernetes Multi-cluster Deployment: Federation and KubeSphere"/>
<meta property="og:description" content="KubeSphere v3.0 supports the management of multiple clusters, isolated management of resources, and federated deployments."/>
<meta property="og:image" content="https://ap3.qingstor.com/kubesphere-website/docs/kubesphere-architecture.png"/>
<meta property="og:url" content="https://kubesphere-v3.netlify.app/blogs/multi-cluster-deployment/"/>

<meta name="docsearch:language" content="en-US" /><link rel="stylesheet" href="/fonts/Roboto/stylesheet.css">
<link rel="stylesheet" href="/fonts/ProximaNova/stylesheet.css">
<link rel="stylesheet" href="/css/jquery.modal.min.css">
<link rel="stylesheet" href="/css/viewer.min.css">


<link rel="stylesheet" href="/scss/common.min.fd2f2584615728a729ee87ecf658d2f2e62d4c55dc6ca4c90029116aa21ee2e8.css">











<script src='/js/jquery-3.5.0.min.js'></script>
<script src='/js/viewer.min.js'></script>
<script src='/js/jquery.modal.min.js'></script>










<script type='text/javascript'>
!function(e,t,n,g,i){e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=('https:'==document.location.protocol?'https://':'http://')+g,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio");
  gio('init', '8a24ae300cbf8b8c', {});
  
  
  gio('send');
</script>





    <link rel="stylesheet" href="/scss/content.min.cd01785de7a83de330d32ac3aef7e5f4e0aa8c5e62c21008e4779016e3fd9517.css">
    
    
    <link rel="stylesheet" href="/scss/markdown.min.0de31cde2c91847e0e6c6f43d52658e6347b056a9da347546c21a7786900bfcf.css">
</head>


<body>
   
  
<header class="navigation">
    
    <div class="common-layout">
        <div class="header-container">
            <a href="/">
                <img src="/images/header/logo.svg" alt="" class="logo">
            </a>

            <ul class="nav">
                
                
                

                
                
                    
                
                    
                
                    
                

                <li  class="menu-li" >
                    <span class='menu-span'>Scenarios</span>
                    <ul class="dropdown-menu menu-2">
                        
                        <li >
                            
                            <a href="/devops/">Embracing One-stop DevOps Workflow</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/service-mesh/">Running Microservices on Kubernetes</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/observability/">Building Cloud Native Observability</a>
                            
                        </li>
                        
                    </ul>
                </li>
                

                
                

                
                
                    
                
                    
                
                    
                
                    
                

                <li  class="menu-li" >
                    <span class='menu-span'>Resources</span>
                    <ul class="dropdown-menu menu-3">
                        
                        <li >
                            
                            <a href="/projects/">Open Source Projects</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/conferences/">KubeCon & QCon</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/blogs/">Technology Blogs</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/videos/">Video Resources</a>
                            
                        </li>
                        
                    </ul>
                </li>
                

                
                

                
                
                    
                
                    
                
                    
                
                    
                

                <li  class="menu-li" >
                    <span class='menu-span'>Documentation</span>
                    <ul class="dropdown-menu menu-4">
                        
                        <li >
                            
                            <a href="/docs/">v3.0.0 <img src='/images/header/star.svg' alt='star'></a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="https://v2-1.docs.kubesphere.io/docs" target="_blank" rel="noopener noreferrer">v2.1.x</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="https://v2-0.docs.kubesphere.io/docs/" target="_blank" rel="noopener noreferrer">v2.0.x</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="https://v1-0.docs.kubesphere.io/docs/" target="_blank" rel="noopener noreferrer">v1.0.0</a>
                            
                        </li>
                        
                    </ul>
                </li>
                

                
                

                
                
                    
                
                    
                
                    
                
                    
                
                    
                

                <li  class="menu-li" >
                    <span class='menu-span'>Community</span>
                    <ul class="dropdown-menu menu-5">
                        
                        <li >
                            
                            <a href="/contribution/">Contribution</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/case/">Case Studies</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/partner/">Partner</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="/news/">News</a>
                            
                        </li>
                        
                        <li >
                            
                            <a href="https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md" target="_blank" rel="noopener noreferrer">RoadMap</a>
                            
                        </li>
                        
                    </ul>
                </li>
                

                

            </ul>
            <div class="right-menu">
                <ul>
                    <li class="language-menu">
                        <div>
                            <img src="/images/header/black.svg" alt="">
                            <span>English</span>
                        </div>
                        
                        <ul class="dropdown-menu">
                            
                            <li onclick="location = '\/blogs\/multi-cluster-deployment\/'">English</li>
                            
                        </ul>
                        
                    </li>
                    <li class='btn-li'>
                        <a href="https://demo.kubesphere.io/login" target="_blank" rel="noopener noreferrer">
                            <button class="demo-btn">Demo →</button>
                        </a>
                        <ol class="dropdown-menu">
                            <li>1.Experience account: demo1 / Demo123</li>
                            <li>2.This account is only allowed to view parts of UI</li>
                            <li>3.It&#39;s recommended that install KubeSphere in your environment</li>
                        </ol>
                    </li>
                    <li class='link-li'>
                        <a class='link-1' href="https://join.slack.com/t/kubesphere/shared_invite/enQtNTE3MDIxNzUxNzQ0LTZkNTdkYWNiYTVkMTM5ZThhODY1MjAyZmVlYWEwZmQ3ODQ1NmM1MGVkNWEzZTRhNzk0MzM5MmY4NDc3ZWVhMjE" target="_blank" rel="noopener noreferrer"></a>
                        <a class='link-2' href="https://twitter.com/KubeSphere" target="_blank" rel="noopener noreferrer"></a>
                        <a class='link-3' href="https://github.com/kubesphere/kubesphere" target="_blank" rel="noopener noreferrer"></a>
                    </li>
                    <li class="menu-icon">
                        <img src="/images/header/menu.svg" alt="">
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="modal-for-menu" class="modal">
        <ul class="nav">
            
            
            

            
            
                
            
                
            
                
            

            <li data-check="0"  class="menu-li" >
                <span class='menu-span'>Scenarios</span>
                <ul class="dropdown-menu">
                    
                    <li >
                        <a href="/devops/">Embracing One-stop DevOps Workflow</a>
                    </li>
                    
                    <li >
                        <a href="/service-mesh/">Running Microservices on Kubernetes</a>
                    </li>
                    
                    <li >
                        <a href="/observability/">Building Cloud Native Observability</a>
                    </li>
                    
                </ul>
            </li>
            

            
            

            
            
                
            
                
            
                
            
                
            

            <li data-check="0"  class="menu-li" >
                <span class='menu-span'>Resources</span>
                <ul class="dropdown-menu">
                    
                    <li >
                        <a href="/projects/">Open Source Projects</a>
                    </li>
                    
                    <li >
                        <a href="/conferences/">KubeCon & QCon</a>
                    </li>
                    
                    <li >
                        <a href="/blogs/">Technology Blogs</a>
                    </li>
                    
                    <li >
                        <a href="/videos/">Video Resources</a>
                    </li>
                    
                </ul>
            </li>
            

            
            

            
            
                
            
                
            
                
            
                
            

            <li data-check="0"  class="menu-li" >
                <span class='menu-span'>Documentation</span>
                <ul class="dropdown-menu">
                    
                    <li >
                        <a href="/docs/">v3.0.0 <img src='/images/header/star.svg' alt='star'></a>
                    </li>
                    
                    <li >
                        <a href="https://v2-1.docs.kubesphere.io/docs">v2.1.x</a>
                    </li>
                    
                    <li >
                        <a href="https://v2-0.docs.kubesphere.io/docs/">v2.0.x</a>
                    </li>
                    
                    <li >
                        <a href="https://v1-0.docs.kubesphere.io/docs/">v1.0.0</a>
                    </li>
                    
                </ul>
            </li>
            

            
            

            
            
                
            
                
            
                
            
                
            
                
            

            <li data-check="0"  class="menu-li" >
                <span class='menu-span'>Community</span>
                <ul class="dropdown-menu">
                    
                    <li >
                        <a href="/contribution/">Contribution</a>
                    </li>
                    
                    <li >
                        <a href="/case/">Case Studies</a>
                    </li>
                    
                    <li >
                        <a href="/partner/">Partner</a>
                    </li>
                    
                    <li >
                        <a href="/news/">News</a>
                    </li>
                    
                    <li >
                        <a href="https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md">RoadMap</a>
                    </li>
                    
                </ul>
            </li>
            

            

        </ul>
        <div class="btn-div">
            <a href="https://demo.kubesphere.io/login" target="_blank" rel="noopener noreferrer">
                <button class="demo-btn">Demo →</button>
            </a>
        </div>
        <div class="link-div">
            <a href="https://join.slack.com/t/kubesphere/shared_invite/enQtNTE3MDIxNzUxNzQ0LTZkNTdkYWNiYTVkMTM5ZThhODY1MjAyZmVlYWEwZmQ3ODQ1NmM1MGVkNWEzZTRhNzk0MzM5MmY4NDc3ZWVhMjE" target="_blank" rel="noopener noreferrer">
                <img src="/images/header/slack-hover.svg" alt="">
            </a>
            <a href="https://twitter.com/KubeSphere" target="_blank" rel="noopener noreferrer">
                <img src="/images/header/twitter-hover.svg" alt="">
            </a>
            <a href="https://github.com/kubesphere/kubesphere" target="_blank" rel="noopener noreferrer">
                <img src="/images/header/github-hover.svg" alt="">
            </a>
        </div>
    </div>
</header>
<script>
var bindNavMouseEvent = function(selector) {
    var flag = false
    $(selector).mouseenter(function() {
        if (flag) {
            return false
        }
        flag = true
        $(this).find('.dropdown-menu').fadeIn(200, function() {
            flag = false
        })
    });
    $(selector).mouseleave(function() {
        $(this).find('.dropdown-menu').fadeOut(200)
    });
}

var bindScrollChangeHeader = function() {
    var check = 100
    var header = $('header')
    window.addEventListener('scroll', function() {
        var scrollY = window.scrollY;
        if (scrollY > 100) {
            header.addClass('navigationScroll')
        } else {
            header.removeClass('navigationScroll')
        }
    })
}

var bindClickShowMenu = function() {
    $('.menu-icon').click(function() {
        $('#modal-for-menu').modal()
    })
}

var bindClickModalLi = function() {
    $('.modal .menu-li').click(function() {
        var check = $(this).data('check')
        if (check === 0) {
            $(this).data('check', 1)
            $(this).find('.dropdown-menu').slideDown(200)
        } else {
            $(this).data('check', 0)
            $(this).find('.dropdown-menu').slideUp(200)
        }
        $(this).find('.menu-span').toggleClass('up')
    })
}

var bindClickClose = function() {
    $('#close-join').click(function() {
        $('.navigation .join-div').hide()
        $('.main-section').removeClass('padding')
    })
}

var language = 'en'

bindClickClose()

bindScrollChangeHeader()

bindNavMouseEvent('.header-container .menu-li')
bindNavMouseEvent('.header-container .language-menu')
bindNavMouseEvent('.header-container .btn-li')

bindClickShowMenu()
bindClickModalLi()


</script>

  <section class="main-section ">
      <div class="common-layout">
          <div class='breadcrumb'>
              
              <span><a href='/blogs'>Technology Blogs</a> > </span>
              <span>Kubernetes Multi-cluster Deployment: Federation and KubeSphere</span>
          </div>
          <div class='main-div middle-div'>
              <div class='author'>Jeff, Feynman, Sherlock</div>
              <div class='date'>Published on：2020-07-20</div>
              <h1>Kubernetes Multi-cluster Deployment: Federation and KubeSphere</h1>
              <div class="share-1">
                  <div class="share">
  <a href="http://twitter.com/share?url=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f&text=Kubernetes%20Multi-cluster%20Deployment%3a%20Federation%20and%20KubeSphere" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Twitter.svg" alt="twitter icon">
  </a>
  <a href="http://reddit.com/submit?url=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f&title=Kubernetes%20Multi-cluster%20Deployment%3a%20Federation%20and%20KubeSphere" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Reddit.svg" alt="reddit icon">
  </a>
  <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Facebook.svg" alt="facebook icon">
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Linkedin.svg" alt="linkedin icon">
  </a>
  <a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f&t=Kubernetes%20Multi-cluster%20Deployment%3a%20Federation%20and%20KubeSphere" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/HackerNews.svg" alt="hackernews icon">
  </a>
</div>
              </div>
              <div class='content'>
                  <div class='md-body'>
                      <h2 id="scenarios-for-multi-cluster-deployment">Scenarios for Multi-cluster Deployment</h2>
<p>As the container technology and Kubernetes see a surge in popularity among their users, it is not uncommon for enterprises to run multiple clusters for their business. In general, here are the main scenarios where multiple clusters can be adopted.</p>
<h3 id="high-availability">High Availability</h3>
<p>You can deploy workloads on multiple clusters by using a global VIP or DNS to send requests to corresponding backend clusters. When a cluster malfunctions or fails to handle requests, the VIP or DNS records can be transferred to a health cluster.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/ha.png" alt="high-availability"></p>
<h3 id="low-latency">Low Latency</h3>
<p>When clusters are deployed in various regions, user requests can be forwarded to the nearest cluster, greatly reducing network latency. For example, we have three Kubernetes clusters deployed in New York, Houston and Los Angeles respectively. For users in California, their requests can be forwarded to Los Angeles. This will reduce the network latency due to geographical distance, providing the most consistent user experience possible for users in different areas.</p>
<h3 id="failure-isolation">Failure Isolation</h3>
<p>Generally, it is much easier for multiple small clusters to isolate failures than a large cluster. In case of outages, network failures, insufficient resources or other possible resulting issues, the failure can be isolated within a certain cluster without spreading to others.</p>
<h3 id="business-isolation">Business Isolation</h3>
<p>Although Kubernetes provides namespaces as a solution to app isolation, this method only represents the isolation in logic. This is because different namespaces are connected through the network, which means the issue of resource preemption still exists. To achieve further isolation, you need to create additional network isolation policies or set resource quotas. Using multiple clusters can achieve complete physical isolation that is more secure and reliable than the isolation through namespaces. For example, this is extremely effective when different departments within an enterprise use multiple clusters for the deployment of development, testing or production environments.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/pipeline.png" alt="pipeline"></p>
<h3 id="avoid-vendor-lock-in">Avoid Vendor Lock-in</h3>
<p>Kubernetes has become the de facto standard in container orchestration. Against this backdrop, many enterprises avoid putting all eggs in one basket as they deploy clusters by using services of different cloud providers. That means they can transfer and scale their business anytime between clusters. However, it is not that easy for them to transfer their business in terms of costs, as different cloud providers feature varied Kubernetes services, including storage and network interface.</p>
<h2 id="multi-cluster-deployment">Multi-cluster Deployment</h2>
<p>The application of multi-cluster deployment offers solutions to a variety of problems as we can see from the scenarios above. Nevertheless, it brings more complexity for operation and maintenance. For a single cluster, app deployment and upgrade are quite straightforward as you can directly update yaml of the cluster. For multiple clusters, you can update them one by one, but how can you guarantee the application load status is the same across different clusters? How to implement service discovery among different clusters? How to achieve load balancing across clusters? The answer given by the community is Federation.</p>
<h3 id="federation-v1">Federation v1</h3>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/federation-v1.png" alt="federation-v1"></p>
<p>There are two versions of Federation with the original v1 already deprecated. In v1, the general architecture is very similar to that of Kubernetes. As shown above, Federation API Server is used for the management of different clusters. It receives the request to create the deployment of multiple clusters as Federation Controller Manager deploys workloads on each cluster.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/annotations.png" alt="annotations"></p>
<p>In terms of API, federated resources are scheduled through annotations, ensuring great compatibility with the original Kubernetes API. As such, the original code can be reused and existing deployment files of users can be easily transferred without any major change. However, this also prevents users from taking further advantage of Federation for API evolution. At the same time, a corresponding controller is needed for each federated resource so that they can be scheduled to different clusters. Originally, Federation only supported a limited number of resource type.</p>
<h3 id="federation-v2">Federation v2</h3>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/federation-v2.png" alt="federation-v2"></p>
<p>The community developed Federation v2 (KubeFed) on the basis of v1. KubeFed has defined its own API standards through CRDs while deprecating the annotation method used before. The architecture has changed significantly as well, discarding Federated API Server and etcd that need to be deployed independently. The control plane of KubeFed adopts the popular implementation of CRD + Controller, which can be directly installed on existing Kubernetes clusters without any additional deployment.</p>
<p>KubeFed mainly defines four resource types:</p>
<ul>
<li>
<p><strong>Cluster Configuration</strong> defines the register information needed for the control plane to add member clusters, including cluster name, APIServer address and the credential to create deployments.</p>
</li>
<li>
<p><strong>Type Configuration</strong> defines the resource type that KubeFed should handle. Each Type Configuration is a CRD object that contains three configuration items:</p>
<ul>
<li><strong>Template.</strong> Templates define the representation of a common resource to be handled. If the object does not have a corresponding definition on the cluster where it will be deployed, the deployment will fail. In the following example of FederatedDeployment, the template contains all the information needed to create the deployment.</li>
<li><strong>Placement</strong>. Placements define the name of the cluster that a resource object will appear in, with two methods available (<code>clusters</code> and <code>clusterSelector</code>).</li>
<li><strong>Override</strong>. Overrides define per-cluster, field-level variation that apply to the template, allowing you to customize configurations. In the example below, the number of replicas defined in <code>template</code> is 1, while <code>overrides</code> shows the replica number of cluster gondor will be 4 when it is deployed instead of 1 in <code>template</code>. A subset of the syntax of <a href="http://jsonpatch.com/" target="_blank" rel="noopener noreferrer">Jsonpatch</a> is achieved in <code>overrides</code>, which means, theoretically, all the content in <code>template</code> can be overridden.</li>
</ul>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/example.png" alt="FederatedDeployment"></p>
</li>
<li>
<p><strong>Schedule</strong> defines how apps are deployed across clusters, mainly related to ReplicaSets and Deployments. The maximum and minimum number of replicas of the load on a cluster can be defined through Schedule, which is similar to the annotation method in v1.</p>
</li>
<li>
<p><strong>MultiClusterDNS</strong> makes it possible for service discovery across clusters. Service discovery across multiple clusters is much more complicated than in a single cluster. ServiceDNSRecord, IngressDNSRecord and DNSEndpoint objects are used in KubeFed to implement service discovery across multiple clusters (DNS needed as well).</p>
</li>
</ul>
<p>In general, KubeFed has provided solutions to many problems in v1. With CRDs, federated resources can be scaled to a large extent. Basically, all Kubernetes resources can be deployed across multiple clusters, including the CRD resources defined by users themselves.</p>
<p>However, KubeFed also has some issues to be resolved:</p>
<ul>
<li><strong>Single point of failure</strong>. The control plane of KubeFed is achieved through CRD + Controller. High availability can be implemented for the controller itself, but the whole control plane will malfunction if Kubernetes it runs on fails. This was also <a href="https://github.com/kubernetes-sigs/kubefed/issues/636" target="_blank" rel="noopener noreferrer">discussed in the community</a> before. Currently, KubeFed uses the push/reconcile method. When federated resources are created, the controller of the control plane will send the resource object to clusters accordingly. After that, the control plane is not responsible for how the member cluster handles resources. Therefore, existing application workloads will not be affected when KubeFed control plane fails.</li>
<li><strong>Maturity</strong>. The KubeFed community is not as active as the Kubernetes community. Its iteration cycle is too slow and many features are still in the beta stage.</li>
<li><strong>Abstraction</strong>. KubeFed defines resources to be managed through Type Configurations. Different Type Configurations only vary in their templates. The advantage is that the logic can be unified so that they can be quickly achieved. In KubeFed, the corresponding Controllers of Type Configuration resources are all created through <a href="https://github.com/kubernetes-sigs/kubefed/blob/master/pkg/controller/federatedtypeconfig/controller.go" target="_blank" rel="noopener noreferrer">templates</a>. That said, the shortcoming is quite obvious as customized features are not supported for special Types. For instance, for a FederatedDeployment object, KubeFed only needs to create a deployment object accordingly based on template and override, which will be deployed on the cluster specified in placement. As for whether the corresponding Pod is created based on the deployment and how the Pod runs, you can only check the information in the related cluster. The community has realized this issue and is working on it. A <a href="https://github.com/kubernetes-sigs/kubefed/pull/1237" target="_blank" rel="noopener noreferrer">proposal</a> has already been raised.</li>
</ul>
<h2 id="multi-cluster-feature-in-kubesphere">Multi-cluster Feature in KubeSphere</h2>
<p>Resource federation is what the community has proposed to solve the issue of deployments across multiple clusters. For many enterprise users, the deployment of multiple clusters is not necessary. What is more important is that they need to be able to manage the resources across multiple clusters at the same time and in the same place.</p>
<p><a href="https://github.com/kubesphere" target="_blank" rel="noopener noreferrer">KubeSphere</a> supports the management of multiple clusters, isolated management of resources, and federated deployments. In addition, it also features multi-dimensional queries (monitoring, logging, events and auditing) of resources such as clusters and apps, as well as alerts and notifications through various channels. Apps can be deployed on multiple clusters with CI/CD pipelines.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/workflow.png" alt="kubesphere-workflow"></p>
<p>KubeSphere 3.0 supports unified management of user access for the multi-cluster feature based on KubeFed, RBAC and Open Policy Agent. With the multi-tenant architecture, it is very convenient for business departments, development teams and Ops teams to manage resources isolatedly in a unified console according to their needs.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/business.png" alt="business"></p>
<h3 id="architecture">Architecture</h3>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/kubesphere-architecture.png" alt="kubesphere-architecture"></p>
<p>The overall multi-cluster architecture of <a href="https://kubesphere.io/" target="_blank" rel="noopener noreferrer">KubeSphere</a> is shown above. The cluster where the control plane is located is called Host cluster. The cluster managed by the Host cluster is called Member cluster, which is essentially a Kubernetes cluster with KubeSphere installed. The Host cluster needs to be able to access the kube-apiserver of Member clusters. Besides, there is no requirement for the network connectivity between Member clusters. The Host cluster is independent of the member clusters managed by it, which do not know the existence of the Host cluster. The advantage of the logic is that when the Host cluster malfunctions, Member clusters will not be affected and deployed workloads can continue to run as well.</p>
<p>In addition, the Host cluster also serves as an entry for API requests. It will forward all resource requests for member clusters to them. In this way, not only can requests be aggregated, but also authentication and authorization can be implemented in a unified fashion.</p>
<h3 id="authorization-and-authentication">Authorization and Authentication</h3>
<p>It can be seen from the architecture that the Host cluster is responsible for the synchronization of identity and access information of clusters, which is achieved by federated resources of KubeFed. When FederatedUser, FederatedRole, or FederatedRoleBinding is created on the Host cluster, KubeFed will push User, Role, or Rolebinding to Member clusters. Any access change will only be applied to the Host cluster, which will then be synchronized to Member clusters. This is to ensure the integrity of each Member cluster. In this regard, the identity and access data stored in Member clusters enable them to implement authentication and authorization independently without any reliance on the Host cluster. In the multi-cluster architecture of KubeSphere, the Host cluster acts as a resource coordinator instead of a dictator, since it delegates power to Member clusters as much as possible.</p>
<h3 id="cluster-connectivity">Cluster Connectivity</h3>
<p>The multi-cluster feature of KubeSphere only entails the access of the Host cluster to the Kubernetes APIServer of Member clusters. There is no requirement for network connectivity at the cluster level. KubeSphere provides two methods for the connection of Host and Member clusters:</p>
<ul>
<li>
<p><strong>Direct connection</strong>. If the kube-apiserver address of Member clusters is accessible on any node of the Host cluster, you can adopt this method. Member clusters only need to provide the cluster kubeconfig. This method applies to most public cloud Kubernetes services or the scenario where the Host cluster and Member clusters are in the same network.</p>
</li>
<li>
<p><strong>Agent connection</strong>. In case Member clusters are in a private network with the kube-apiserver address unable to be exposed, KubeSphere provides <a href="https://github.com/kubesphere/tower" target="_blank" rel="noopener noreferrer">Tower</a> for agent connection. Specifically, the Host cluster will run a proxy service. When a new cluster joins, the Host cluster will generate all credential information. Besides, the agent running on Member clusters will connect to the proxy service running on the Host cluster. A reverse proxy will be created after the handshake succeeds. As the kube-apiserver address of Member clusters will change in agent connection, the Host cluster needs to create a new kubeconfig for Member clusters. This is very convenient as the underlying details can be hidden. In either direct connection or agent connection, the control plane is provided with a kubeconfig that can be used directly.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/cluster-tunnel.jpg" alt="cluster-tunnel"></p>
</li>
</ul>
<h3 id="api-forwarding">API Forwarding</h3>
<p>In the multi-cluster architecture of KubeSphere, the Host cluster serves as a cluster entry. All API requests are directly sent to the Host cluster first, which will decide where these requests go next. To provide the best compatibility possible with the original API in the multi-cluster environment, the API request whose path begins with <code>/apis/clusters/{cluster}</code> will be forwarded to the cluster <code>{cluster}</code>, with <code>/clusters/{cluster}</code> removed. The advantage is that there is no difference between the request the cluster receives this way with other requests, with no additional configuration or operation needed.</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/api-forwarding.png" alt="api-forwarding"></p>
<p>For example:</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/api-fowarding1.png" alt="api-fowarding1"></p>
<p>The request above will be forwarded to a cluster named rohan and be handled as:</p>
<p><img src="https://ap3.qingstor.com/kubesphere-website/docs/api-forwarding2.png" alt="api-forwarding2"></p>
<h2 id="summary">Summary</h2>
<p>The topic of multi-cluster deployment is far more complicated than we think. The fact that the Federation solution provided by the community has not been officially released after two versions is a typical example. As we often put it, there is no Silver Bullet in software engineering. It is impossible for multi-cluster tools such as KubeFed and KubeSphere to solve all the issues. We need to find the solution that best suits us based on the specific business scenario. It is believed that these tools will become more mature over time, which can be applied in more scenarios.</p>
<h2 id="references">References</h2>
<ol>
<li>KubeFed: <a href="https://github.com/kubernetes-sigs/kubefed">https://github.com/kubernetes-sigs/kubefed</a></li>
<li>KubeSphere Website: <a href="https://kubesphere.io/">https://kubesphere.io/</a></li>
<li>Kubernetes Federation Evolution: <a href="https://kubernetes.io/blog/2018/12/12/kubernetes-federation-evolution/">https://kubernetes.io/blog/2018/12/12/kubernetes-federation-evolution/</a></li>
<li>KubeSphere GitHub: <a href="https://github.com/kubesphere">https://github.com/kubesphere</a></li>
</ol>

                  </div>
              </div>
              <div class="share-2">
                  <div class="share">
  <a href="http://twitter.com/share?url=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f&text=Kubernetes%20Multi-cluster%20Deployment%3a%20Federation%20and%20KubeSphere" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Twitter.svg" alt="twitter icon">
  </a>
  <a href="http://reddit.com/submit?url=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f&title=Kubernetes%20Multi-cluster%20Deployment%3a%20Federation%20and%20KubeSphere" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Reddit.svg" alt="reddit icon">
  </a>
  <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Facebook.svg" alt="facebook icon">
  </a>
  <a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/Linkedin.svg" alt="linkedin icon">
  </a>
  <a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fkubesphere-v3.netlify.app%2fblogs%2fmulti-cluster-deployment%2f&t=Kubernetes%20Multi-cluster%20Deployment%3a%20Federation%20and%20KubeSphere" target="_blank" rel="noopener noreferrer">
    <img src="/images/share/HackerNews.svg" alt="hackernews icon">
  </a>
</div>
              </div>
          </div>
          <div class='aside'>
              <div class="inner-div">
                <div class='title'>Table of Contents</div>
                <div class='tabs'><nav id="TableOfContents">
  <ul>
    <li><a href="#scenarios-for-multi-cluster-deployment">Scenarios for Multi-cluster Deployment</a>
      <ul>
        <li><a href="#high-availability">High Availability</a></li>
        <li><a href="#low-latency">Low Latency</a></li>
        <li><a href="#failure-isolation">Failure Isolation</a></li>
        <li><a href="#business-isolation">Business Isolation</a></li>
        <li><a href="#avoid-vendor-lock-in">Avoid Vendor Lock-in</a></li>
      </ul>
    </li>
    <li><a href="#multi-cluster-deployment">Multi-cluster Deployment</a>
      <ul>
        <li><a href="#federation-v1">Federation v1</a></li>
        <li><a href="#federation-v2">Federation v2</a></li>
      </ul>
    </li>
    <li><a href="#multi-cluster-feature-in-kubesphere">Multi-cluster Feature in KubeSphere</a>
      <ul>
        <li><a href="#architecture">Architecture</a></li>
        <li><a href="#authorization-and-authentication">Authorization and Authentication</a></li>
        <li><a href="#cluster-connectivity">Cluster Connectivity</a></li>
        <li><a href="#api-forwarding">API Forwarding</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
              </div>
          </div>
      </div>
  </section>
  <footer>
    
    <div class="footer">
        <div class="footer-main common-layout">
            <div class="up-main">
                <div class="left-div">
                    <img src="/images/logo.svg" alt="" class="foot-logo">
                    <p>Receive the latest news, articles and updates from KubeSphere</p>
                    <div>
                        <form
                            action="https://kubesphere.us10.list-manage.com/subscribe/post?u=c85ea2b944b08b951f607bdd4&amp;id=83f673a2d9"
                            method="post"
                            target="_blank"
                            novalidate
                        >
                            <input name="EMAIL" id="email-input" type="text" placeholder='Please enter your email address'>
                            <button type="submit" id="email-submit">Subscribe</button>
                        </form>
                    </div>
                    <span id="message" data-message1='email is required!' data-message2='Please enter a valid email address!'></span>
                </div>
                <div class="right-div">
                    <ul class="common-flex-layout">
                        
                        
                            <li>
                                <div class="h3">Scenarios</div>
                                
                                
                                <a href="/devops/">Embrace DevOps</a>
                                
                                
                                
                                <a href="/service-mesh/">Microservices on K8s</a>
                                
                                
                                
                                <a href="/observability/">Cloud Native Observability</a>
                                
                                
                                
                                <a href="https://porterlb.io/" target="_blank" rel="noopener noreferrer">Bare Metal LoadBalancer</a>
                                
                                
                                
                                <a href="https://github.com/openpitrix/openpitrix" target="_blank" rel="noopener noreferrer">Multi-cloud Apps Mgmt</a>
                                
                                
                                
                                <a href="https://github.com/kubesphere/fluentbit-operator" target="_blank" rel="noopener noreferrer">Logging management</a>
                                
                                
                            </li>
                        
                            <li>
                                <div class="h3">Resources</div>
                                
                                
                                <a href="/projects/">Projects</a>
                                
                                
                                
                                <a href="/blogs/">Blogs</a>
                                
                                
                                
                                <a href="/conferences/">KubeCon &amp; QCon</a>
                                
                                
                                
                                <a href="/videos/">Videos</a>
                                
                                
                            </li>
                        
                            <li>
                                <div class="h3">KubeSphere Docs</div>
                                
                                
                                <a href="/../../../docs/introduction/what-is-kubesphere/">Introduction</a>
                                
                                
                                
                                <a href="/../../../docs/quick-start/all-in-one-on-linux/">Installation</a>
                                
                                
                                
                                <a href="/../../../docs/quick-start/create-workspace-and-project/">Tutorial</a>
                                
                                
                                
                                <a href="/../../../docs/api-reference/api-docs/">API Documentation</a>
                                
                                
                            </li>
                        
                            <li>
                                <div class="h3">Community</div>
                                
                                
                                <a href="/contribution/">Contribution</a>
                                
                                
                                
                                <a href="/case/">Case Studies</a>
                                
                                
                                
                                <a href="/partner/">Partners</a>
                                
                                
                                
                                <a href="https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md" target="_blank" rel="noopener noreferrer">Roadmap</a>
                                
                                
                                
                                <a href="https://kubesphere.io" target="_blank" rel="noopener noreferrer">Global Site</a>
                                
                                
                                
                                <a href="https://kubesphere.com.cn/" target="_blank" rel="noopener noreferrer">China Site</a>
                                
                                
                                
                                <a href="https://kubesphere.eu" target="_blank" rel="noopener noreferrer">Europe Site</a>
                                
                                
                                
                                <a href="https://kubesphereturkey.com" target="_blank" rel="noopener noreferrer">Turkey Site</a>
                                
                                
                                
                                <a href="https://kubesphere.es" target="_blank" rel="noopener noreferrer">Spain Site</a>
                                
                                
                            </li>
                        
                        
                    </ul>
                </div>
            </div>
            <div class="down-main">
                <div class='img-div'>
                    <a class='wechat' href="javascript:void(0);">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28">
    <defs>
        <path id="a" d="M0 0h15.673v12.156H0z"/>
    </defs>
    <g fill="none" fill-rule="evenodd" transform="translate(1 1)">
        <circle cx="13" cy="13" r="13" stroke="#B6C2CD"/>
        <g transform="translate(5 7)">
            <mask id="b" fill="#fff">
                <use xlink:href="#a"/>
            </mask>
            <path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59 0-4.625 1.679-4.625 3.74 0 2.066 2.035 3.738 4.625 3.738.542 0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27 0-.541-.257-.541-.514 0-.256.27-.514.541-.514.41 0 .681.258.681.514 0 .257-.271.514-.681.514zm2.994 0c-.27 0-.541-.257-.541-.514 0-.256.27-.514.54-.514.41 0 .681.258.681.514 0 .257-.277.514-.68.514z" mask="url(#b)"/>
            <path fill="currentColor" d="M10.602 3.674c.177 0 .356.011.533.029C10.657 1.576 8.27 0 5.543 0 2.498 0 0 1.974 0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17 0 .343-.005.515-.022a3.68 3.68 0 0 1-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417 0 .693.263.693.66s-.276.66-.693.66c-.418 0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417 0-.834-.263-.834-.66s.417-.66.834-.66c.418 0 .695.263.695.66 0 .392-.277.66-.695.66z" mask="url(#b)"/>
        </g>
    </g>
</svg>

                        <div class="hide-div">
                            <p>Follow the official account</p>
                            <img src="/images/footer/wechat_code.svg" alt="">
                        </div>
                    </a>
                    <a class='facebook-a' href="https://www.facebook.com/kubesphere" target="_blank"></a>
                    <a class='twitter-a' href="https://twitter.com/KubeSphere" target="_blank" rel="noopener noreferrer"></a>
                    <a class='linkedin-a' href="https://www.linkedin.com/company/kubesphere/" target="_blank" rel="noopener noreferrer"></a>
                    
                    <a class='youtube-a' href="https://www.youtube.com/channel/UCyTdUQUYjf7XLjxECx63Hpw" target="_blank" rel="noopener noreferrer"></a>
                    <a class='slack-a' href="https://join.slack.com/t/kubesphere/shared_invite/enQtNTE3MDIxNzUxNzQ0LTZkNTdkYWNiYTVkMTM5ZThhODY1MjAyZmVlYWEwZmQ3ODQ1NmM1MGVkNWEzZTRhNzk0MzM5MmY4NDc3ZWVhMjE" target="_blank" rel="noopener noreferrer"></a>
                    <a class='github-a' href="https://github.com/kubesphere/kubesphere" target="_blank" rel="noopener noreferrer"></a>
                    <a class='medium-a' href="https://itnext.io/@kubesphere" target="_blank" rel="noopener noreferrer"></a>
                </div>
                <p class='p1'>KubeSphere®️ 2020 All Rights Reserved.</p>
                
            </div>
        </div>
    </div>

</footer>

<script>
    var bindSubmit = function() {
        var input = $('#email-input')
        $('#email-submit').click(function(event) {
            event.stopPropagation()
            var email = input.val()
            var message1 = $('#message').data('message1')
            var message2 = $('#message').data('message2')
            if (!email) {
                event.preventDefault()
                showMessage(message1)
            } else if (!validateEmail(email)) {
                event.preventDefault()
                showMessage(message2)
            }
        })
    }

    var bindHideMessage = function() {
        $(window).click(function() {
            $('#message').hide()
        })
    }

    var showMessage = function(message) {
        $('#message').html(message).show()
    }

    var validateEmail = function(email) {
        var reg = /^[A-Za-z0-9]+([_\.][A-Za-z0-9]+)*@([A-Za-z0-9\-]+\.)+[A-Za-z]{2,6}$/
        return reg.test(email)
    }

    var lazyLoad = function(allImg, imgNum) {
        for (var i = 0; i < imgNum; i++) {
            var img = allImg.eq(i)
            var loaded = img.attr("data-loaded");
            if (loaded) {
                continue
            }
            if (img.offset().top < parseInt($(window).height()) + parseInt($(window).scrollTop())) {
                var src = img.attr("src")
                img.attr("src", src)
                img.attr("data-loaded", true)
            }
        }
    }

    var bindLayLoad = function() {
        var allImg = $('img')
        var imgNum = allImg.length
        lazyLoad(allImg, imgNum)
        $(window).scroll(function() {
            lazyLoad(allImg, imgNum)
        });
    }

    
    bindSubmit()
    bindHideMessage()
</script>

  
  
  <script type="text/javascript" src="/js/aside.34d4ca232760855916fede489417772adb45cdceab8541c6f6826e5d83a0b68e071a44f76a077fe90e39afe213cc1aab40272900f7cbdffb45068c7746c7b183.js" integrity="sha512-NNTKIydghVkW/t5IlBd3KttFzc6rhUHG9oJuXYOgto4HGkT3agd/6Q45r&#43;ITzBqrQCcpAPfL3/tFBox3Rsexgw=="></script>
  
  
  
  <script type="text/javascript" src="/js/markdown-tab.224c8a343197870e80877ad07e19b932b807d3fde3abccde667f2156378cb00497ebb11d2f872f09ea91e7282e87655f8cb4ef163da46e34d00dca44dbf52aad.js" integrity="sha512-IkyKNDGXhw6Ah3rQfhm5MrgH0/3jq8zeZn8hVjeMsASX67EdL4cvCeqR5yguh2VfjLTvFj2kbjTQDcpE2/UqrQ=="></script>
  
  <script>
    var viewer = new Viewer(document.querySelector('.md-body'), {
        url: 'src'
    })
  </script>
</body>

</html>
